"0","# Investigate the influence of previous days"
"0",""
"0","# Ensure the data are sorted by Date"
"0","sleep <- sleep %>% arrange(Date)"
"0",""
"0","# Create lagged variables and rolling averages for previous day's, previous 3 days, and previous 7 days."
"0","# The lag() function from dplyr creates the previous dayâ€™s values."
"0","# The rollmean() function from zoo calculates the rolling (moving) average."
"0","sleep <- sleep %>%"
"0","  mutate("
"0","    # Previous day's values"
"0","    lag1_TST = lag(TST, 1),"
"0","    lag1_TTS = lag(TTS, 1),"
"0","    lag1_TBT = lag(TBT, 1),"
"0","    lag1_Run = lag(Run, 1),"
"0","    "
"0","    # Average of previous 3 days"
"0","    avg3_TST = rollmean(lag(TST, 1), k = 3, fill = NA, align = ""right""),"
"0","    avg3_TTS = rollmean(lag(TTS, 1), k = 3, fill = NA, align = ""right""),"
"0","    avg3_TBT = rollmean(lag(TBT, 1), k = 3, fill = NA, align = ""right""),"
"0","    avg3_Run = rollmean(lag(Run, 1), k = 3, fill = NA, align = ""right""),"
"0","    "
"0","    # Average of previous 7 days."
"0","    avg7_TST = rollmean(lag(TST, 1), k = 7, fill = NA, align = ""right""),"
"0","    avg7_TTS = rollmean(lag(TTS, 1), k = 7, fill = NA, align = ""right""),"
"0","    avg7_TBT = rollmean(lag(TBT, 1), k = 7, fill = NA, align = ""right""),"
"0","    avg7_Run = rollmean(lag(Run, 1), k = 7, fill = NA, align = ""right"")"
"0","  )"
"0",""
"0","# Because the first few rows will have NA values (since there are not enough previous days),"
"0","# we filter out rows with missing lagged/rolling values."
"0","sleep_model <- sleep %>%"
"0","  filter(!is.na(lag1_TST),"
"0","         !is.na(avg3_TST),"
"0","         !is.na(avg7_TST))"
"0",""
"0","head(sleep_model)"
